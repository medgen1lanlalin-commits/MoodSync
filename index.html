import React, { useState, useEffect } from 'react';
import { 
  Heart, 
  Smile, 
  Frown, 
  Meh, 
  Activity, 
  Utensils, 
  Brain, 
  BarChart2, 
  Users, 
  AlertCircle, 
  Zap, 
  Watch,
  PlusCircle,
  TrendingUp,
  CloudRain,
  Sun,
  ChevronRight
} from 'lucide-react';

// --- Sub-Components ---

const NavButton = ({ icon, label, active, onClick }) => (
  <button 
    onClick={onClick}
    className={`flex flex-col items-center gap-1 transition-all duration-300 ${active ? 'text-rose-500 scale-110' : 'text-gray-400'}`}
  >
    <div className={`${active ? 'bg-rose-50 p-2 rounded-xl' : ''}`}>
      {icon}
    </div>
    <span className="text-[10px] font-bold">{label}</span>
  </button>
);

const Dashboard = ({ moodLogs, foodLogs, score, onNavigate }) => {
  const lastMood = moodLogs[moodLogs.length - 1] || { level: 3, label: 'ปกติ' };

  const getRecommendation = () => {
    if (!lastMood) return { title: "กำลังวิเคราะห์...", desc: "เริ่มบันทึกอารมณ์ของคุณวันนี้" };
    if (lastMood.level <= 2) return { 
      tag: "Energy Boost", 
      title: "ข้าวไรซ์เบอร์รี่อกไก่และถั่วอัลมอนด์", 
      desc: "อารมณ์เหนื่อยล้าต้องการ Low GI เพื่อรักษาระดับพลังงานให้คงที่" 
    };
    if (lastMood.level === 3) return { 
      tag: "Gut Health", 
      title: "กรีกโยเกิร์ตพร้อมเบอร์รี่รวม", 
      desc: "เติม Probiotics เพื่อกระตุ้น Gut-Brain Axis ให้รู้สึกสดชื่นขึ้น" 
    };
    return { 
      tag: "Maintain Happiness", 
      title: "สลัดคินัวและดาร์กช็อกโกแลต", 
      desc: "แมกนีเซียมและสารต้านอนุมูลอิสระช่วยรักษาอารมณ์ดีให้ยาวนาน" 
    };
  };

  const recommendation = getRecommendation();

  return (
    <div className="space-y-6 animate-in fade-in duration-500">
      {/* Header */}
      <div className="flex justify-between items-center px-2">
        <div>
          <h2 className="text-2xl font-black text-gray-800 tracking-tight">MoodSync</h2>
          <p className="text-xs text-rose-400 font-bold uppercase tracking-widest">Bio-Feedback Sync</p>
        </div>
        <div className="w-10 h-10 bg-gradient-to-tr from-rose-400 to-orange-300 rounded-full border-2 border-white shadow-lg flex items-center justify-center text-white font-bold">
          N
        </div>
      </div>

      {/* Daily Summary Card */}
      <div className="bg-white rounded-[2.5rem] p-6 shadow-xl shadow-rose-100/50 border border-rose-50 relative overflow-hidden">
        <div className="absolute top-0 right-0 p-4">
          <TrendingUp size={20} className="text-rose-200" />
        </div>
        <p className="text-gray-400 text-xs font-bold mb-1 uppercase">Food-Mood Index Today</p>
        <div className="flex items-end gap-2 mb-4">
          <span className="text-5xl font-black text-gray-800">{score}</span>
          <span className="text-gray-400 font-bold mb-1">/ 100</span>
        </div>
        <div className="flex gap-2">
          <span className="px-3 py-1 bg-green-50 text-green-600 rounded-full text-[10px] font-bold">#SugarStable</span>
          <span className="px-3 py-1 bg-blue-50 text-blue-600 rounded-full text-[10px] font-bold">#GutBalanced</span>
        </div>
      </div>

      {/* Bio-Feedback Integration */}
      <div className="bg-gray-900 rounded-[2.5rem] p-6 text-white shadow-2xl relative overflow-hidden group">
        <div className="absolute -right-10 -bottom-10 w-40 h-40 bg-rose-500/20 rounded-full blur-3xl group-hover:bg-rose-500/30 transition-all"></div>
        <div className="flex justify-between items-center mb-6">
          <div>
            <h3 className="font-bold text-lg">Real-time Stress (HRV)</h3>
            <p className="text-xs text-gray-400 flex items-center gap-1">
              <Watch size={12} /> Linked with Apple Watch
            </p>
          </div>
          <Activity className="text-rose-400 animate-pulse" />
        </div>
        <div className="flex items-center gap-4">
          <span className="text-4xl font-black tracking-tighter">64ms</span>
          <div className="h-1 flex-1 bg-gray-800 rounded-full overflow-hidden">
            <div className="h-full bg-gradient-to-r from-rose-500 to-orange-400 w-[64%]"></div>
          </div>
        </div>
      </div>

      {/* Nutritional Prescription */}
      <div className="space-y-4">
        <div className="flex justify-between items-center px-2">
          <h3 className="font-black text-gray-800 text-lg">เมนูแนะนำตามอารมณ์</h3>
          <button className="text-xs font-bold text-rose-500 flex items-center gap-1">
            ดูทั้งหมด <ChevronRight size={14} />
          </button>
        </div>

        <div className="bg-white rounded-[2rem] p-5 shadow-sm border border-gray-100 hover:shadow-md transition-shadow">
          <div className="flex items-center gap-2 mb-3">
             <span className="px-2 py-0.5 bg-rose-50 text-rose-500 text-[10px] font-bold rounded-md uppercase tracking-wider">
               {recommendation.tag}
             </span>
             <span className="text-[10px] text-gray-400 font-medium">
               Mood: {lastMood.label}
             </span>
          </div>
          <h4 className="font-bold text-gray-800 mb-1">{recommendation.title}</h4>
          <p className="text-xs text-gray-500 leading-relaxed">
            {recommendation.desc}
          </p>
        </div>
      </div>
    </div>
  );
};

// --- Main App Component ---

const App = () => {
  const [activeTab, setActiveTab] = useState('dashboard');
  const [moodLogs, setMoodLogs] = useState([{ level: 3, label: 'ปกติ' }]);
  const [foodLogs, setFoodLogs] = useState([]);
  const [score, setScore] = useState(82);

  const renderContent = () => {
    switch(activeTab) {
      case 'dashboard':
        return <Dashboard moodLogs={moodLogs} foodLogs={foodLogs} score={score} onNavigate={setActiveTab} />;
      case 'log':
        return <div className="p-8 text-center text-gray-400">หน้าบันทึกข้อมูล (Coming Soon)</div>;
      case 'insight':
        return <div className="p-8 text-center text-gray-400">หน้าวิเคราะห์เชิงลึก (Coming Soon)</div>;
      case 'community':
        return <div className="p-8 text-center text-gray-400">หน้าชุมชน (Coming Soon)</div>;
      default:
        return <Dashboard moodLogs={moodLogs} foodLogs={foodLogs} score={score} />;
    }
  };

  return (
    <div className="min-h-screen bg-[#FAFAFA] text-gray-900 font-sans pb-32">
      <div className="max-w-md mx-auto min-h-screen bg-white shadow-2xl relative overflow-hidden">
        
        {/* Main Content Area */}
        <div className="p-6">
          {renderContent()}
        </div>

        {/* Bottom Navigation */}
        <div className="fixed bottom-0 max-w-md w-full bg-white/80 backdrop-blur-xl border-t border-gray-100 px-8 py-5 flex justify-between items-center z-50 rounded-t-[2.5rem] shadow-[0_-10px_40px_rgba(0,0,0,0.05)]">
          <NavButton 
            icon={<Activity size={22} />} 
            label="สถิติ" 
            active={activeTab === 'dashboard'} 
            onClick={() => setActiveTab('dashboard')} 
          />
          <NavButton 
            icon={<PlusCircle size={22} />} 
            label="บันทึก" 
            active={activeTab === 'log'} 
            onClick={() => setActiveTab('log')} 
          />
          <NavButton 
            icon={<BarChart2 size={22} />} 
            label="วิเคราะห์" 
            active={activeTab === 'insight'} 
            onClick={() => setActiveTab('insight')} 
          />
          <NavButton 
            icon={<Users size={22} />} 
            label="ชุมชน" 
            active={activeTab === 'community'} 
            onClick={() => setActiveTab('community')} 
          />
        </div>
      </div>

      <style>{`
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800;900&display=swap');
        body { font-family: 'Inter', sans-serif; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
      `}</style>
    </div>
  );
};

export default App;

